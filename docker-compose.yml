version: "2"
services:
  varnish:
    image: eeacms/varnish
    restart: 'always'
    ports:
      - 8080:6081/tcp
    environment:
      BACKENDS: ploneidg
      BACKENDS_PORT: '8080'
      BACKENDS_PROBE_INTERVAL: 3s
      BACKENDS_PROBE_THRESHOLD: '2'
      BACKENDS_PROBE_TIMEOUT: 1s
      BACKENDS_PROBE_WINDOW: '3'
      DNS_ENABLED: 'true'
    hostname: varnish
    links:
    - ploneidg:ploneidg

  zeoserver:
    hostname: 'zeoserver'
    image: unixelias/plone.idg:latest
    command:
      - zeoserver
    volumes:
    - data:/data/filestorage
    - data:/data/blobstorage
    - data:/data/backups
    - data:/data/blobstoragebackups

  ploneidg:
    image: unixelias/plone.idg:latest
    depends_on:
      - zeoserver
    environment:
      - ZEO_ADDRESS=zeoserver:8100

volumes:
  data:
    driver: local-persist
    driver_opts:
      mountpoint: /srv/portal/data
      command: chown -R 500:500 /data
