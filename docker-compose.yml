version: "2"
services:
  haproxy:
    image: eeacms/haproxy
    restart: 'always'
    depends_on:
      - portal
    ports:
      - 8090:5000
      - 1936:1936
    environment:
      - BACKENDS=portal
      - BACKENDS_PORT=8080
      - SERVICE_NAMES=portal
      - DNS_ENABLED=true

  zeoserver:
    hostname: 'zeoserver'
    image: unixelias/plone.idg:latest
    command:
      - zeoserver
    volumes:
      - data:/data

  portal:
    image: unixelias/plone.idg:latest
    depends_on:
      - zeoserver
    environment:
    - ZEO_ADDRESS=zeoserver:8100

volumes:
  data:
    driver: local-persist
    driver_opts:
      mountpoint: /srv/portal/data
      command: chown -R 500:500 /data
